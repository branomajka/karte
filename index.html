<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kartaška tabela 4 igrača</title>

  <style>
    :root {
      --border: #ddd;
      --shadow: rgba(0,0,0,.06);
      --yellow: #ffe066;
      --blueRow: #f2f8ff;
    }

    * { box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      margin: 12px;
      background: #fff;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
    }

    .card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 1px 4px var(--shadow);
      width: 100%;
      margin-bottom: 12px;
    }

    .grid-names {
      display: grid;
      grid-template-columns: repeat(4, minmax(160px, 1fr));
      gap: 10px;
    }

    .grid-inputs {
      display: grid;
      grid-template-columns: repeat(4, minmax(140px, 1fr));
      gap: 10px;
      align-items: end;
    }

    label {
      display: block;
      font-size: 12px;
      margin-bottom: 6px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 14px;
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    button {
      padding: 10px 14px;
      border: 0;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn {
      background: #1976d2;
      color: #fff;
    }

    .btnDanger {
      background: #c62828;
      color: #fff;
    }

    .btnMini {
      padding: 6px 10px;
      border-radius: 9px;
      font-size: 12px;
    }

    .btnMiniDanger {
      background: #c62828;
      color: #fff;
    }

    .tableWrap {
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 820px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px 8px;
      text-align: center;
      white-space: nowrap;
    }

    th {
      background: var(--yellow);
    }

    .sumrow td {
      background: var(--blueRow);
      font-weight: bold;
    }

    .tfoot td {
      background: var(--yellow);
      font-weight: bold;
    }

    @media (max-width: 820px) {
      .grid-names,
      .grid-inputs {
        grid-template-columns: repeat(2, 1fr);
      }

      button {
        width: 100%;
      }
    }

    @media (max-width: 420px) {
      .grid-names,
      .grid-inputs {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <div class="grid-names">
      <div><label>Igrač 1</label><input id="p1" type="text" /></div>
      <div><label>Igrač 2</label><input id="p2" type="text" /></div>
      <div><label>Igrač 3</label><input id="p3" type="text" /></div>
      <div><label>Igrač 4</label><input id="p4" type="text" /></div>
    </div>
  </div>

  <div class="card">
    <div class="grid-inputs">
      <div><label>Unos (Igrač 1)</label><input id="s1" type="text" inputmode="decimal" /></div>
      <div><label>Unos (Igrač 2)</label><input id="s2" type="text" inputmode="decimal" /></div>
      <div><label>Unos (Igrač 3)</label><input id="s3" type="text" inputmode="decimal" /></div>
      <div><label>Unos (Igrač 4)</label><input id="s4" type="text" inputmode="decimal" /></div>
    </div>

    <div class="actions">
      <button id="addBtn" class="btn">Upiši u prvi slobodan red</button>
      <button id="resetBtn" class="btnDanger">Reset</button>
    </div>
  </div>

  <div class="tableWrap">
    <table>
      <thead>
        <tr>
          <th>Deli</th>
          <th id="h1">Igrač 1</th>
          <th id="h2">Igrač 2</th>
          <th id="h3">Igrač 3</th>
          <th id="h4">Igrač 4</th>
          <th>Brisanje</th>
        </tr>
      </thead>
      <tbody id="body"></tbody>
      <tfoot id="foot"></tfoot>
    </table>
  </div>

</div>

<script>
(() => {

  const els = {
    p: [null,p1,p2,p3,p4],
    s: [null,s1,s2,s3,s4],
    h: [null,h1,h2,h3,h4],
    body,
    foot,
    addBtn,
    resetBtn
  };

  let state = {
    names: ["","Igrač 1","Igrač 2","Igrač 3","Igrač 4"],
    rounds: []
  };

  const toInt = (v) => {
    if (!v) return 0;
    const m = String(v).trim().match(/^-?\d+/);
    return m ? parseInt(m[0],10) : 0;
  };

  const save = () =>
    localStorage.setItem("karte4_state", JSON.stringify(state));

  const load = () => {
    const s = localStorage.getItem("karte4_state");
    if (s) state = JSON.parse(s);
  };

  const render = () => {
    for (let i=1;i<=4;i++) {
      els.h[i].textContent = state.names[i] || `Igrač ${i}`;
      els.p[i].value = state.names[i] || "";
    }

    body.innerHTML = "";
    foot.innerHTML = "";

    let sum = [0,0,0,0,0];

    state.rounds.forEach((r,idx)=>{
      for (let i=1;i<=4;i++) sum[i]+=r[i-1];
      const tr=document.createElement("tr");
      tr.className="sumrow";
      tr.innerHTML=`
        <td>${state.names[(idx%4)+1]||"Igrač"} deli</td>
        <td>${sum[1]}</td><td>${sum[2]}</td>
        <td>${sum[3]}</td><td>${sum[4]}</td>
        <td><button data-i="${idx}" class="btnMini btnMiniDanger">Obriši</button></td>`;
      body.appendChild(tr);
    });

    const tr=document.createElement("tr");
    tr.className="tfoot";
    tr.innerHTML=`
      <td>UKUPNO</td>
      <td>${sum[1]}</td><td>${sum[2]}</td>
      <td>${sum[3]}</td><td>${sum[4]}</td>
      <td></td>`;
    foot.appendChild(tr);

    document.querySelectorAll("[data-i]").forEach(b=>{
      b.onclick=()=>{
        state.rounds.splice(b.dataset.i,1);
        render();
      };
    });

    save();
  };

  addBtn.onclick=()=>{
    state.rounds.push([
      toInt(s1.value),
      toInt(s2.value),
      toInt(s3.value),
      toInt(s4.value)
    ]);
    s1.value=s2.value=s3.value=s4.value="";
    render();
    s1.focus();
  };

  resetBtn.onclick=()=>{
    if(confirm("Obrisati sve?")){
      state.rounds=[];
      render();
    }
  };

  for(let i=1;i<=4;i++){
    els.p[i].oninput=()=>{
      state.names[i]=els.p[i].value;
      render();
    };

    els.s[i].oninput=()=>{
      let v=els.s[i].value;
      v=v.replace(/[^\d-]/g,"");
      v=v.replace(/(?!^)-/g,"");
      els.s[i].value=v;
    };
  }

  load();
  render();
})();
</script>
</body>
</html>
